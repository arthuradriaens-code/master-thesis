\documentclass[11pt,a4paper,faculty=we,language=en,doctype=report]{cls/ugent-doc}

% Optional: margins and spacing
%-------------------------------
% Uncomment and adjust to change the default values set by the template
% Note: the defaults are suggested values by Ghent University
%\geometry{bottom=2.5cm,top=2.5cm,left=3cm,right=2cm} 
%\renewcommand{\baselinestretch}{1.15} % line spacing
\setlength{\headheight}{13.59999pt}

% Python code
%---------------------------------------------
\usepackage{tcolorbox}
\tcbuselibrary{minted,breakable,xparse,skins}

\definecolor{bg}{gray}{0.95}
\DeclareTCBListing{mintedbox}{O{}m!O{}}{%
  breakable=true,
  listing engine=minted,
  listing only,
  minted language=#2,
  minted style=default,
  minted options={%
    linenos,
    gobble=0,
    breaklines=true,
    breakafter=,,
    fontsize=\small,
    numbersep=8pt,
    #1},
  boxsep=0pt,
  left skip=0pt,
  right skip=0pt,
  left=25pt,
  right=0pt,
  top=3pt,
  bottom=3pt,
  arc=5pt,
  leftrule=0pt,
  rightrule=0pt,
  bottomrule=2pt,
  toprule=2pt,
  colback=bg,
  colframe=orange!70,
  enhanced,
  overlay={%
    \begin{tcbclipinterior}
    \fill[orange!20!white] (frame.south west) rectangle ([xshift=20pt]frame.north west);
    \end{tcbclipinterior}},
  #3}
%---------------------------------------------

%------
% Font
%------
%\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc} % allows non-ascii input characters
\usepackage{tikz-feynman}
% Comment or remove the two lines below to use the default Computer Modern font
%\usepackage{libertine}
%\usepackage{libertinust1math}
\usepackage{csvsimple}

%\usepackage[sc]{mathpazo} %font or smth
\linespread{1.05}
%\usepackage{microtype}

\usepackage{fancyhdr} % Headers and footers
\pagestyle{fancy} % All pages have headers and footers e.g contents above contents (except new ones)
\usepackage[Rejne]{fncychap} %fancy chapters
%options for chapters: Sonny, Lenny, Glenn, Conny, Rejne, Bjarne, Bjornstrup

% NOTE: because the UGent font Panno is proprietary, it is not possible to use it
% in Overleaf. But UGent does not suggest to use Panno for documents (or maybe only for
% the titlepage). For the body, the UGent suggestion is to use a good serif font (for
% LaTeX this could be libertine or Computer Modern).
\usepackage{slashed}
\usepackage{braket}

% Proper word splitting
%-----------------------
\usepackage[english]{babel} 

% Mathematics
%-------------
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{mathrsfs}
% Figures
%---------
%\usepackage{graphicx} % optional: the package is already loaded by the template
\graphicspath{{./figures/}}
\usepackage{copyrightbox}
% Bibliography settings
%-----------------------
\usepackage{cite}

% Hyperreferences
%-----------------
\usepackage[colorlinks=true, allcolors=ugentblue]{hyperref}

% Whitespace between paragraphs and no indentation
%--------------------------------------------------
\usepackage[parfill]{parskip} 

% Input for title page
%----------------------

% The title
\thetitle{Radio detection of high energy neutrinos in the Greenland icecap}
\thesubtitle{Arthur Adriaens}

%% Note: a stricter UGent style could be achieved with, e.g.:
\usepackage{ulem} % for colored underline
\renewcommand{\ULthickness}{2pt} % adjust thickness of underline
\thetitle{\uline{\color{ugentblue}Radio detection of high energy neutrinos in the Greenland icecap}}
% Note: do not forget to reset the \ULthickness to 1pt after invoking \maketitle
% (otherwise all underlines in the rest of your document will be too thick):
%\renewcommand{\ULthickness}{1pt}

% The first (top) infobox at bottom of titlepage
\infoboxa{\bfseries\large Department of Physics and Astronomy}

% The second infobox at bottom of titlepage
\infoboxb{Promotor: 
\begin{tabular}[t]{ll}
    Prof. dr. Dirk Ryckbosch & Dirk.Ryckbosch@ugent.be\\ % note syntax 'short space'
\end{tabular}
}

% The third infobox at bottom of titlepage
\infoboxc{Accompanist: 
\begin{tabular}[t]{ll}
    Bob Oeyen &  Bob.Oeyen@ugent.be\\
\end{tabular}
}

% The last (bottom) infobox at bottom of titlepage
\infoboxd{Academic year: 2022--2023} % note dash, not hyphen
\infoboxd{Master’s dissertation submitted in partial fulfilment of the requirements for the degree of master in Physics and Astronomy}

\begin{document}

% =====================================================================
% Cover
% =====================================================================

% ------------ TITLE PAGE ---------
\maketitle
\renewcommand{\ULthickness}{1pt}

% =====================================================================
% Front matter
% =====================================================================
\shipout\null
\newpage
% ------------ TABLE OF CONTENTS ---------
{\hypersetup{hidelinks}\tableofcontents} % hide link color in toc
\newpage


% =====================================================================
% Main matter
% =====================================================================
\chapter{Foreword}
\section*{English}
The Radio Neutrino Observatory in Greenland - RNO-G - is under construction at
Summit Station in Greenland to search for neutrinos of several PeV energy up to
the Eev range. It's a mid-scale, discovery phase, extremely high-energy
neutrino telescope that will probe the astrophysical neutrino flux at energies
beyond the reach of IceCube.  More particularly if will make it possible to
reach the next major milestone in astroparticle physics: the discovery of
cosmogenic neutrinos.
\vspace{0.5cm}
All simulations carried out within this work were made with the three programs 
\begin{itemize}
	\item NuRadioMC
	\item radiotools
	\item RadioPropa
\end{itemize}
whom are free to download on \href{https://github.com/nu-radio}{github}.  This
masters thesis consists of three major parts, first off a background is given
on what neutrinos are and how the detector works, these are chapters 2-4, then
chapter 5 explains how a new algorithm called the \textit{Hybrid minimizer} was
built. This is an algorithm for finding the path(s) of a radio source (e.g a neutrino interaction)
to the detector in complex ice models. And lastly, in chapter 6 it's explained
how an indirect measurement was done of the index of refraction around the deep
components of the detector using both weather balloon gps data and detector
responses.
All the code for both the simulations carried out throughout this thesis as well
as the testing of the algorithm that was built can be found \href{https://github.com/arthuradriaens-code/projects-mt}{here},
the algorithm itself can be found \href{https://github.com/arthuradriaens-code/NuRadioMC}{here}
within the branch radiopropa/hybrid\_minimizer.

\newpage
\section*{Nederlands}
De \textit{Radio Neutrino Observatory in Greenland} - RNO-G - is een detector
die momenteel onder constructie is in Groenland. Deze detector heeft als doel
het vinden van neutrinos met energieën van enkele PeV tot in het EeV gebied.
Deze extreem hoge energie neutrino telescoop zal astrofysische neutrinos zoeken
op energieën waar icecube te klein voor is. Het zal ook het vinden van
cosmogenische neutrinos mogelijk maken.  Alle simulaties werden mogelijk
gemaakt door de volgende programmas:
\begin{itemize}
	\item NuRadioMC
	\item radiotools
	\item RadioPropa
\end{itemize}
Dewelke te downloaden zijn op \href{https://github.com/nu-radio}{github} Deze
master thesis is opgebouwd uit 3 delen. Hoofdstukken 2 t.e.m 4 zijn
achtergrondinformatie, waarna in hoofdstuk 5 het bouwen van een algoritme
uitgelegd wordt en in hoofdstuk 6 worden indirecte metingen gedaan gebruik makende
van gemeten weerballon data.  Het algoritme werd gebouwd in de eerste helft
van het jaar en heet de \textit{Hybrid minimizer}: een algoritme gemaakt met als
doel het snel vinden van een pad vanuit een radio bron vertex (bv een neutrino
interactie) tot de detector in complexe ijsmodellen. De indirecte metingen
werden verwerkt in de tweede helft van het academiejaar, hier werd gebruik
gemaakt van de locatie-info van de weerballon en de response van de detectors
om een schatting te maken van de index van refractie lokaal aan de verscheidene
channels van de detectoren.
De code dienend tot het testen van het gemelde algoritme en het uitvoeren van 
genoemde simulaties kan \href{https://github.com/arthuradriaens-code/projects-mt}{hier}
gevonden worden en het algoritme zelf kan \href{https://github.com/arthuradriaens-code/NuRadioMC}{hier}
gevonden worden onder de branch radiopropa/hybrid\_minimizer
% =====================================================================
\chapter{Neutrinos}
%\includegraphics[width=0.5\textwidth]{standard_model.png}

When looking outside into the night sky you might see various stars, but
invisible to the naked eye various kinds of particles are also traversing
light-years to end up where you stand.

When looking at phenomena outside our earth the astronomer will turn to
electromagnetic radiation, as a lot of the most interesting events emit photons
in some kind of way. But he's missing out on a big part of
the full picture.  There are regions in the universe from which photons can't
escape. They can also be absorbed on their way to earth.  That's where the
astroparticle physicist comes in who takes a look at muons, nuclei,... and
neutrinos.

Neutrinos are often called “ghost” particles because they very rarely interact
with matter, on average 100 trillion neutrinos pass through your body per
second, none of them having any effect.  You'd even need a light year of lead
to give you just a 50\% chance of stopping a neutrino.

As they also have no charge they are not deflected by magnetic fields. This means
that once a cosmic neutrino is detected and it's direction is inferred, it's origin
can be found.

Because they can travel huge distances without getting distorted or
sidetracked, neutrinos are ideal messengers to identify sources of ultra high
energy (UHE) cosmic rays in the universe.  Neutrinos can serve as unique clues
about what’s happening elsewhere in the universe including the cosmic
collisions, galaxies, supernovae, Gamma-ray bursts (GRBs),... where they are created.

\section{Discovery}
When researching $\beta^-$ decay, the decay of a neutron, researcher
detected a proton and an electron coming from the neutron. However
on closer inspection it became apparent that energy was lost
somewhere in violation with the conservation law of energy, and
angular momentum wasn't conserved.  The solution postulated by
Wolfgang Pauli was to introduce a new, really hard to detect
particle with no charge and a very small mass: the neutrino.  The neutrino comes in three flavours:
electron, muon and tau neutrinos, each corresponding to their respective lepton denoted as
\begin{equation}
	\nu_e \quad \nu_\mu \quad \nu_\tau
\end{equation}
and each also having an anti-particle.
\begin{equation}
	\bar{\nu}_e \quad \bar{\nu}_\mu \quad \bar{\nu}_\tau
\end{equation}

Now with the introduction of the neutrino the full $\beta^-$ decay
becomes
\begin{equation}
	n \rightarrow p^+ + e^- + \nu_e
\end{equation}
The inverse can then also be used to detect neutrinos:
\begin{equation}
	n \rightarrow p^+ + e^- + \nu_e
\end{equation}
Which is called beta capture and was first experimentally detected in 1956
\cite{BetaCapture} also making it the first experimental detection of a
neutrino.
\section{Neutrino sources}
%The radio detection of neutrinos targets the energy range 10PeV to 100EeV\cite{Aguilar_2021} 
Neutrinos can be generated in 2 ways: either they're generated in
interactions at the sources, termed \textit{astrophysical neutrinos}. Or
they're created through the interaction of ultra-high energy cosmic rays during
propagation with the cosmic microwave or other photon backgrounds termed
\textit{cosmogenic neutrinos}. 
In figure \ref{figure:Neutrino fluxes} you see the neutrino flux theoretically expected 
in function of energy for various sources of neutrinos. I'll walk you through each of
them seperately, going from smallest energy and flux to highest.
\begin{figure}
	\centering
	\copyrightbox[r]{\includegraphics[height = 0.5\textwidth]{neutrinofluxes.pdf}}{\textcopyright Abhik Jash, Studies on the Physics of Resistive Plate Chambers in Relation to the INO Experiment}
	\caption{Predicted neutrino flux for various natural sources}
	\label{figure:Neutrino fluxes}
\end{figure}
\subsection{Cosmological/Primordial neutrinos}
The first source of neutrinos we'll talk about is the one in blue to the left of the figure
termed the \textit{Cosmological neutrinos}: 
the neutrino version of the CMB.
To understand this source we'll have to go back all the way to just after the big bang:
The very early universe was hot and dense. As a result, interactions among particles
occurred much more frequently than they do today. As an example, a photon today
can travel across the observable universe without deflection or capture, so it has a
mean free path greater than $10^{26}$ m. When the universe was 1 second old, though, 
the mean free path of a photon was about the size of an atom. Thus in
the time it took the universe to expand by a factor of 2, a given photon interacted
many, many times. These multiple interactions kept the consitituents in the universe
in thermal equilibrium. But as the universe expanded there were times when reactions could
not proceed rapidly enough to maintain equilibrium conditions, these particles then fall out
of thermal equilibrium. This falling out of equilibrium is termed \textit{decoupling}.
And we're interested in when neutrinos decoupled.
Neutrinos were kept in equilibrium through the interaction 
\begin{equation}
	\nu e \leftrightarrow \nu e
\end{equation}
up until the universe cooled down to about 1MeV when they decoupled.
To estimate the temperature of the neutrinos who decoupled at the start of the universe, 
we can take a look at conservation of entropy \cite{Dodelson} from which we'll find that:
\begin{equation}
	T_\nu = \left(\frac{4}{11}\right)^{1/3}T_\gamma
\end{equation}
Note that they decoupled before the photons making them lower in temperature.
As $T_\gamma$ is the CMB temperature which, nowadays, is measured to be around 2.7K,
these primordial neutrinos are very low in energy.
\subsection{Solar neutrinos}
The sun fuses elements to release energy and thus keeping itself from collapsing in 
on itself, with most of the various ways particles get fused, neutrinos get released:\\
$\bold{pp-cycle}$
\begin{align}
	\mathrm{p} + \mathrm{p} &\rightarrow \mathrm{D} + e^+ + \nu_e\\
	\mathrm{D} + \mathrm{p} &\rightarrow {}^3\mathrm{He} + \gamma\\
	{}^3\mathrm{He} + {}^3\mathrm{He} &\rightarrow {}^4\mathrm{He} + \mathrm{p} + \mathrm{p}
\end{align}\\
$\bold{boron-cycle}$
\begin{align}
{ }^4 \mathrm{He}+{ }^3 \mathrm{He} & \rightarrow{ }^7 \mathrm{Be}+\gamma \\
{ }^7 \mathrm{Be}+p & \rightarrow { }^8\mathrm{B} + \gamma \\
{ }^8 \mathrm{B} & \rightarrow{ }^8 \mathrm{Be}^*+e^{+}+\nu_e \\
{ }^8 \mathrm{Be}^* & \rightarrow{ }^4 \mathrm{He}+{ }^4 \mathrm{He}
\end{align}\\
$\bold{Be-capture}$
\begin{align}
	^7\mathrm{Be} + e^- \rightarrow {}^7\mathrm{Li} + \nu_e
\end{align}
$\bold{pep}$
\begin{align}
	\mathrm{p} + e^- + \mathrm{p} \rightarrow \mathrm{D} + \nu_e
\end{align}\\
Now with this and some information about the sun like the pressure and mass,
the so-called "standard solar model" was made. This model predicted a certain
amount of neutrinos to be hitting the earth from the previously mentioned
thermonuclear fusion, it was however 3 times higher than the observed amount of
neutrinos back at our planet. This led to a little bit of hysteria as this could've meant
that the sun was dying and we'd see the aftermath only in a couple of years.
Through various experiments however, it became apparent that this was due to
the different kinds of neutrinos oscillating into each other on their way to
earth, i.e 2/3 of the original electron neutrinos had oscillated into mu and
tau neutrinos. But for them to oscillate into eachother, they not
only require mass but each flavor also should have a different mass as can be seen
from an example 2D approximation to the transition probability:
\begin{equation}
	P(\nu_e\rightarrow\nu_\mu) = |\braket{\nu_\mu|\psi(L,T)}|^2 = c_\mu c_\mu^* = \sin ^2(2 \theta) \sin ^2\left(\frac{\Delta \phi_{12}}{2}\right)
\end{equation}
with
\begin{equation}
	\Delta \phi_{12} \approx \frac{m_1^2 - m_2^2}{2p}L
\end{equation}
In full generality (3D):
\begin{equation}
	\ket{\nu_\alpha} = \sum_iU_{\alpha i} \ket{\nu_i}
\end{equation}
With $U_{\alpha i}$ the Pontecorvo-Maki-Nakagawa-Sakata (PMNS) matrix. 
This phenomenon has been observed e.g through the descrepency from the observed
and expected neutrino events coming from a nuclear reactor \cite{Eguchi_2003}.
\subsection{Supernovae}
\label{sec:supernovae}
A star starts its life as a ball of pure hydrogen. At the core, due to the
gravitational pressure of the outside plasma, fusion of hydrogen into deuterium
and helium happens. Thus converting mass into energy. The pressure of this energy
counteracts the pressure of gravity and the star is stable.

When the hydrogen at the core runs out no more hydrogen can be fused. For
stars with masses between $8M_\odot$ and $30M_\odot$ the
fusion of heavier elements starts, this can't keep going on however as at some
point the star starts to form the most stable element: iron. 
\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.5\textwidth]{Binding_energy_curve.png}
	\caption{Energy per nucleon i.f.o number of nucleons in the nucleus}
	\label{fig:BindingEnergyCurve}
\end{figure}
It costs energy
to both make lighter elements than iron and heavier ones.  As the iron core
builds up the outside pressure from the core starts to decrease as no new
energy is released. This goes on until  the treshold of an iron core with a mass of 1.4$M_\odot$ known as the 
Chandrasekhar limit is reached and the the inwards pressure becomes too large,
making the electrons surrounding the iron core fuse with the protons (uud),
creating neutrons (udd) and neutrinos, diagramatically shown in figure
\ref{fig:CoreFusion}.
\begin{figure}
	\centering
	\begin{tikzpicture}
	\begin{feynman}
	\vertex (a0){u};
	\vertex[right=2cm of a0] (am) ;
	\vertex[right=2cm of am] (a1) {d};
	\vertex[above=2cm of am] (bm);
	\vertex[above=2cm of a0] (b0){$e^-$};
	\vertex[right=2cm of bm] (b1){$\nu_e$};
	\diagram* {
		{[edges=fermion]
			(a0) -- (am) -- (a1)
		},
		{[edges=fermion]
			(b0) -- (bm) -- (b1)
		},
		{[edges=boson,edge label=$W^+$]
			(am) -- (bm)
		}
	};
	\end{feynman}
	\end{tikzpicture}
	\caption{fusion of protons with surrounding electrons into neutrons via the weak force}
	\label{fig:CoreFusion}
\end{figure}\\
This last part happens in a split second as the collapse goes at 25\% the speed
of light, creating a very dense neutron star (3000km in diameter iron core to
30km in diameter neutron star) and up to $10^{52}$ ultra-relativistic
neutrinos, carrying up to 99\%\footnote{$\approx$1\% is released as kinetic energy, only 0.001\% as
electromagnetic radiation} of the released energy
\cite{Melson_2015}. As the density has suddenly increased so much
there's a huge distance of pure vaccuum between the plasma outer layer and the
(now) neutron star, this plasma starts free-falling inwards, also at 25\% the
speed of light whilst the neutrinos carrying tremendous amounts of energy start
going outwards from the neutron stars core.

The neutrinos then collide with the plasma resulting in what we observe as a
"supernova", wrongly thought of by Kepler as being a "new (nova) star" rather
being a violent death of an old star.

This is quite unexpected as neutrinos rarely interact, it's only as the
incoming plasma is so dense and due to the tremendous amount of neutrinos that
collissions happen at all. Some, however, escape and will be visible on earth
in our neutrino detectors $\approx$ 18h before the light escapes the exploding
star.

Neutrino observatories are thus also useful to know where to point our various
telescopes before the supernova is actually visible in the night sky.
\subsection{Terrestrial anti-neutrinos}
Terrestrial anti-neutrinos, also termed \textit{geoneutrinos} are neutrinos
coming from the decay of radionuclides (unstable nuclides due to excess in
nuclear energy) naturally occuring in our earth.  Most geoneutrinos are
electron antineutrinos originating in $\beta^-$ decay modes of ${}^{40}$K,
${}^{232}$Th and ${}^{238}$U. Together these decay chains account for more than
99\% of the present-day radiogenic heat generated inside the Earth

\subsection{Reactor anti-neutrinos}
Arguably our most important energy source today, both in terms of energy output
and their impact on the enviroment are fission reactors.  Looking back at
figure \ref{fig:BindingEnergyCurve} we see that all the way to the right
uranium is found, a lot of energy can thus be released by splitting in into
nuclei with a lower amount of nucleons.  Fission reactors operate by splitting
this urantium via the introduction of a neutron:
\begin{equation}
	n + {}^{235}U \rightarrow \text{Energy (radiation)} + 2\times\text{Fission fragments} + 2.5\times n
\end{equation}
this 2.5 is of course an average. The surplus of neutrons means that this is a
self-sustaining reaction implying that for a stable thermonuclear fission
reaction, carbon capture rods are needed.  When this uranium nucleus fissions
into two daughter nuclei fragments, about 0.1 percent of the mass of the
uranium nucleus appears as the fission energy which is about ~200 MeV. For
uranium-235 about ~169 MeV appears as the kinetic energy of the daughter nuclei
, the neutrons carry a mean kinetic energy per neutron of ~2 MeV (total of 4.8
MeV) and ~7 MeV is released in the form of gamma ray photons.  This all sums up
to the \textit{total prompt fission energy} which amounts to about 181 MeV, or
~89\% of the total energy which is eventually released by fission over time.
The remaining ~11\% is released in beta decays where we get our reactor
anti-neutrinos from.
\subsection{Background from old supernovae}
Also termed the \textit{diffuse supernova neutrino background} (DSNB), as the
universe is quite old various supernovae have happened over it's lifetime, each generating
a lot of neutrinos as was discussed in section \ref{sec:supernovae}. 
This is postulated to have generated a continuous neutrino background.
\subsection{Cosmic rays}
Before we can talk about atmospheric neutrinos it's necessary to discuss \textit{cosmic rays}.
Cosmic rays are ionized nuclei of which 90\% are protons, 9\% are alpha particles and
the rest are heavier nuclei. Almost all of them originate from outside the solar system but
from within our galaxy, the few particles that do come from our solar system can be temporally
linked to violent events on the sun. In contrast to this the particles coming from outside
our solar system show an anti-correlation with the sun as they can more easily reach the earth
if solar activity is low.
It has been observed that they roughly follow a power-law spectrum 
$N \propto E^{-\gamma}$ \cite{gaisser_engel_resconi_2016}.
\subsection{Atmospheric neutrinos}
\label{sec:AtmosphericNeutrinos}
Cosmic rays hit the Earth's atmosphere at a rate of about 1000 per square meter
per second and interact with atomic nuclei in the Earth's atmosphere, creating
showers of particles, many of which are unstable and produce neutrinos when
they decay, these neutrinos are what's called \textit{Atmospheric neutrinos}.
Most notably neutrinos can be produced together with muons in the two-body
decays of charged pions and kaons wherever these hadronic interactions occur.
The most important production channels and their branching ratios for neutrinos
are:
\begin{align}
	\pi^\pm &\rightarrow \mu^\pm + \nu_\mu(\bar{\nu}_\mu) (\sim 100\%)\\
	K^\pm &\rightarrow \mu^\pm + \nu_\mu(\bar{\nu}_\mu) (\sim 63.5\%)
\end{align}
Neutrinos are subsequently also produced when these muons decay:
\begin{equation}
	\mu^\pm \rightarrow e^\pm + \nu_e(\bar{\nu}_e) + \bar{\nu}_\mu(\nu_\mu)
\end{equation}
which is a process mainly happening at low energies in the atmosphere.  The
atmospheric neutrino spectrum shown in figure \ref{figure:Neutrino
fluxes} roughly follows a power spectrum as the cosmic ray flux follows a power
spectrum but the correspondence isn't one-to-one as, due to the difference in
kinematics, the contribution from kaons to neutrinos is significantly more
important than to muons, especially at high energies.

\subsection{neutrinos from AGNs}
An AGN (active galactic nucleus) is deemed to be the reason why several abnormal galaxies exist with
an extra bright (and mostly variable) light source in their core which even the biggest of telescopes
can't spatially discern. The general concensus is that this phenomenon is caused by one particular
kind of object: a supermassive black hole (a black hole with a mass of at least 105M$_\odot$) surrounded with
a close torus of dust and gas.
This torus of gas is called an \textit{accretion disc} and is an enormous source of energy. The conversion
of potential energy of the incoming gas to highly energetic radiation is a very complex physical process
with which we have to account for various factors like gravitational instabilities, magnetic fields, hydrodynamical
turbulence,... And thus produces a spectrum that's quite complex.
It would appear that the luminocity of an AGN would increase indefinitely with incoming mass, but this process is 
limited: if too much matter accretes on the black hole the radiative pressure becomes too massive and the 
matter on the disc gets blown away, this phenomenon is termed a \textit{black hole outburst}.

The emission of high energy neutrinos from AGNs rests solely on the premise
that relativistic protons of sufficiently high energy and energy density in the
AGN's accretion disc will be present \cite{NASANeutrinos} as they may interact
to create e.g pions whom decay. A direct consequence of the occurence of these
relativistic protons is the production of $\gamma$-rays of similar energies to
those of the neutrinos, thus high energy neutrino- and $\gamma$-ray astronomy are
closely related.  However, even though $\gamma$-ray photons can be produced
even in the absence of relativistic protons (e.g via high energy electrons),
neutrinos can not.  Thus the detection of these high-energy neutrinos (which
might have already been detected \cite{AGNNeutrino}) will provide unique
information about the workings of AGNs.

\subsection{Cosmogenic neutrinos}
And now finally one of the most exciting neutrino sources (maybe) observable on
earth: cosmogenic neutrinos. The mechanism by which these get created is quite
simple, if a proton has sufficiently high energy the cross section to interact
with CMB (Cosmic Microwave Background) photons becomes non-negligable.  These
protons can scatter off the photons to resonantly produce a $\Delta^+$ baryon.
This resonance has enough mass to dominantly decay to a pion and a nucleon:
\begin{align}
	\Delta^+ &\rightarrow \pi^0 + p \ \ (2/3)\\
	\Delta^+ &\rightarrow \pi^+ + n \ (1/3)
\end{align}
Of which the charged pion decays to neutrinos as previously mentioned in 
\ref{sec:AtmosphericNeutrinos}.
\subsection{How do they fit into the full detector spectrum?}
The origin of the most energetic cosmic rays is still not conclusively
identified. One approach to solving this problem is \textit{multi-messenger
astrophysics}, where several types of cosmic particles are used to identify the
sources of these ultra-high energy cosmic rays (UHECRs). E.g we simultaneously
measure gravitational waves with the Einstein telescope,
neutrinos with IceCube (or eventually RNO-G), photons with various telescopes
and muons with a muon detector.
\newpage
\section{Current research}
There are still a lot of unknowns concerning neutrinos, for the interested reader 
here I'll quickly go over current research into the most prominent questions. Namely
"How do neutrinos get their mass? (theoretically)" and "are neutrinos Majorana?".
\subsection{Mass}
As neutrinos oscillate they must have mass, the currently most exciting theory to 
explain the origins of this mass is the \textit{See-Saw mechanism} here mass is given
via a simple Yukawa coupling:
\begin{equation}
	\mathcal{L} = i\bar{\nu}\slashed{\partial}\nu - m\bar{\psi}\nu - \frac{M}{2} (\bar{\nu}_R\nu_{Rc} + \bar{\nu}_{Rc}\nu_R)
\end{equation}
The exciting part about this theory however is that you can re-write this with
\begin{align}
	\chi &:= \frac{1}{\sqrt{2}} (\psi_R + \psi_{Rc})\\
	\omega &:= \frac{1}{\sqrt{2}} (\psi_L + \psi_{Lc})
\end{align}
And after some math find that you'll get the eigenvectors $\phi_\pm$ with eigenvalues $m_\pm$:
\begin{equation}
	\phi_\pm := \left(\begin{array}{c}
		x_\pm\\
		y_\pm
	\end{array}\right) = \left(\begin{array}{c}
		\frac{\lambda_\pm}{\sqrt{\lambda_\pm^2 + m^2}}\\
		\frac{m}{\sqrt{\lambda_\pm^2 + m^2}}
	\end{array}\right) \quad \text{ and }\quad m_\pm := \lambda_\pm =  \frac{M}{2}\left( 1 \pm \sqrt{1 + 4m^2/M^2}\right)
\end{equation}
Now in the limit $M \gg m$, in the $\chi,\omega$ basis:
\begin{align}
	m_+\approx M \quad &\text{with eigenstate} \quad \chi + \frac{m}{M}\omega\\
	m_-\approx -\frac{m^2}{M} \quad &\text{with eigenstate} \quad  \omega - \frac{m}{M}\chi\\
\end{align}
This is why it's called the  See-Saw mechanism : For a certain $m$ if we choose a big $M$ we'll
get a big $m_+$ and small $m_-$ (and vice versa). We also see that there's only
a very small mixing of states, i.e the $m_-$ mass state is almost purely
$\omega$ (and $m_+$ almost purely $\chi$). The parameter $m$ in the original
matrix is forbidden by electroweak gauge symmetry, and can only appear after
the symmetry has been spontaneous broken by a Higgs mechanism; for this reason
a good estimate of the order of $m$ is the vaccuum expectation energy:
$m\approx v = 246 \approx 10^2$GeV. In grand unified theories it's theorised
that $M\approx 10^{15}$GeV after symmetry breaking, using these values we get
\begin{align}
	m_- \approx 10^{-11}\text{GeV} \approx 10^{-2} \text{eV}
\end{align}
which seems \cite{neutrino-mass} to be a reasonable order of magnitude estimate for the observed neutrino
mass.
This mechanism would also lead to supermassive neutrinos, which are a possible dark matter
candidate.
\newpage
\subsection{Majorana}
A theory that's also quite interesting is that
neutrinos are majorana, meaning that they are their own anti-particle.
A dirac fermion has the following density:
\begin{align}
  \mathcal{L} &= i\bar{\psi}\slashed{\partial}\psi - m\bar{\psi}\psi\\
              &= i\bar{\psi}_L\slashed{\partial}\psi_L + i\bar{\psi}_R\slashed{\partial}\psi_R - m\bar{\psi}_R\psi_L - m\bar{\psi}_L\psi_R
\end{align}
Now assume that we only have right-handed particles:
\begin{equation}
  \mathcal{L} = i\bar{\psi}_R\slashed{\partial}\psi_R - \frac{M}{2}\bar{\psi}_R\psi_{Rc} - \frac{M}{2}\bar{\psi}_{Rc}\psi_R
\label{eqn:right-handed}
\end{equation}
A majorana fermion is a fermion which is it's own anti-particle, i.e:
\begin{align}
  \chi = \frac{1}{\sqrt{2}}\left( \psi_R + \psi_{Rc}  \right) = \chi_c
\end{align}
With this we can re-write equation \ref{eqn:right-handed} as:
\begin{equation}
  \mathcal{L} = i\bar{\chi}\slashed{\partial}\chi - M \bar{\chi}\chi
\end{equation}
Thus arriving at a density for Majorana fermions with mass M, this would be an exciting property
for neutrinos as it would lead to the possibility of
\textit{Neutrinoless double beta decay}:
\begin{figure}[h!]
	\begin{minipage}{\textwidth}
		\begin{minipage}{0.49\textwidth}
			\centering
			\begin{tikzpicture}
				\begin{feynman}
					\vertex (a0) {\(n\)};
					\vertex[right=3cm of a0] (a1) {\(p^+\)};
					\vertex[right=1.5cm of a0] (am);
					\vertex[right=0.5cm of am] (awi);
					\vertex[above=1cm of awi] (aw);
					\vertex[right=1cm of aw] (avm);
					\vertex[above=0.3cm of avm] (av1) {\(\bar{\nu}_e\)};
					\vertex[below=0.3cm of avm] (av0) {\(e^-\)};
					
					\vertex[above=3.7cm of a0] (b0) {\(n\)};
					\vertex[right=3cm of b0] (b1) {\(p^+\)};
					\vertex[right=1.5cm of b0] (bm);
					\vertex[right=0.5cm of bm] (bwi);
					\vertex[below=1cm of bwi] (bw);
					\vertex[right=1cm of bw] (bvm);
					\vertex[above=0.3cm of bvm] (bv1) {\(\bar{\nu}_e\)};
					\vertex[below=0.3cm of bvm] (bv0) {\(e^-\)};
					
					\diagram* {
						{[edges=fermion]
							(a0) -- (am) -- (a1)
						},
						{[edges=boson,edge label= W]
							(am) -- (aw)
						},
						{(av1) -- [fermion] (aw) --[fermion] (av0)},
						
						{[edges=fermion]
							(b0) -- (bm) -- (b1)
						},
						{[edges=boson,edge label= W]
							(bm) -- (bw)
						},
						(bv1) -- [fermion] (bw) --[fermion] (bv0),
						
					};
				\end{feynman}
			\end{tikzpicture}
		\end{minipage}
		\begin{minipage}{0.49\textwidth}
			\centering
			\begin{tikzpicture}
				\begin{feynman}
					\vertex (a0) {\(n\)};
					\vertex[right=3cm of a0] (a1) {\(p^+\)};
					\vertex[right=1.5cm of a0] (am);
					\vertex[right=0.5cm of am] (awi);
					\vertex[above=1cm of awi] (aw);
					\vertex[right=1cm of aw] (avm);
					\vertex[above=0.85cm of aw] (av1);
					\vertex[below=0.3cm of avm] (av0) {\(e^-\)};
					
					\vertex[above=3.7cm of a0] (b0) {\(n\)};
					\vertex[right=3cm of b0] (b1) {\(p^+\)};
					\vertex[right=1.5cm of b0] (bm);
					\vertex[right=0.5cm of bm] (bwi);
					\vertex[below=1cm of bwi] (bw);
					\vertex[right=1cm of bw] (bvm);
					\vertex[below=0.85cm of bw] (bv1);
					\vertex[above=0.3cm of bvm] (bv0) {\(e^-\)};
					\vertex[below=0.6cm of bw] (ann) {X};
					
					\diagram* {
						{[edges=fermion]
							(a0) -- (am) -- (a1)
						},
						{[edges=boson,edge label= W]
							(am) -- (aw)
						},
						{(av1) -- [fermion] (aw) --[fermion] (av0)},
						
						{[edges=fermion]
							(b0) -- (bm) -- (b1)
						},
						{[edges=boson,edge label= W]
							(bm) -- (bw)
						},
						(bv1) -- [fermion] (bw) --[fermion] (bv0),
						
					};
				\end{feynman}
			\end{tikzpicture}
		\end{minipage}
	\end{minipage}
	\caption{normal and neutrinoless double beta decay}
\end{figure}\\
\newpage
\chapter{Radio detection of neutrinos}
\section{Neutrino interactions in ice}
As neutrinos propagate through ice they can interact with nuclei in the following ways\cite{NuRadioMc}:
\begin{figure}[h!]
	\begin{minipage}{\textwidth}
		\begin{minipage}{0.49\textwidth}
			\centering
			\begin{tikzpicture}
				\begin{feynman}
					\vertex (a0) {quark};
					\vertex[above=0.5cm of a0] (a1) {quark};
					\vertex[above=0.5cm of a1] (a2) {quark};
					\vertex[right=2cm of a0] (b0) {quark};
					\vertex[right=2cm of a1] (b1) {quark};
					\vertex[right=2cm of a2] (b2) {quark};
					\vertex[right=1.0cm of a2] (am);
					\vertex[above=1cm of am] (c0);
					\vertex[above=1cm of c0] (c1);
					\vertex[above=1cm of c1] (cm);
					\vertex[left=1cm of cm] (a3) {$\nu_l$};
					\vertex[right=1cm of cm] (b3) {$l$};
					\diagram* {
						{[edges=fermion]
							(a0) -- (b0)
						},
						{[edges=fermion]
							(a1) -- (b1)
						},
						{[edges=fermion]
							(a2) -- (c0) -- (b2)
						},
						{[edges=fermion]
							(a3) -- (c1) -- (b3)
						},
						{[edges=boson, edge label=W]
							(c0) -- (c1)
						},
					};
				\end{feynman}
			\end{tikzpicture}
		\end{minipage}
		\begin{minipage}{0.49\textwidth}
			\centering
			\begin{tikzpicture}
				\begin{feynman}
					\vertex (a0) {quark};
					\vertex[above=0.5cm of a0] (a1) {quark};
					\vertex[above=0.5cm of a1] (a2) {quark};
					\vertex[right=2cm of a0] (b0) {quark};
					\vertex[right=2cm of a1] (b1) {quark};
					\vertex[right=2cm of a2] (b2) {quark};
					\vertex[right=1.0cm of a2] (am);
					\vertex[above=1cm of am] (c0);
					\vertex[above=1cm of c0] (c1);
					\vertex[above=1cm of c1] (cm);
					\vertex[left=1cm of cm] (a3) {$\nu$};
					\vertex[right=1cm of cm] (b3) {$\nu$};
					\diagram* {
						{[edges=fermion]
							(a0) -- (b0)
						},
						{[edges=fermion]
							(a1) -- (b1)
						},
						{[edges=fermion]
							(a2) -- (c0) -- (b2)
						},
						{[edges=fermion]
							(a3) -- (c1) -- (b3)
						},
						{[edges=boson, edge label=Z]
							(c0) -- (c1)
						},
					};
				\end{feynman}
			\end{tikzpicture}
		\end{minipage}
	\end{minipage}
	\caption{Most prominent ways of neutrino-nucleus interaction}
\end{figure}\\
With the produced leptons in the W boson mediated interaction being either electrons,
resulting in an electromagnetic shower, muons wich typically go undetected as they live
too long or
tauons wich will decay via
\begin{equation}
	\tau^- \rightarrow e^- + \bar{\nu}_e + \nu_\tau
\end{equation}
or, less ideally
\begin{equation}
	\tau^- \rightarrow \mu^- + \bar{\nu}_\mu + \nu_\tau
\end{equation}
In both of the possible interactions (W or Z exchange) the resulting nucleus
will result in a hadronic shower, for the neutral current interaction (mediated
by the Z boson) the fraction of the neutrino energy that gets transferred to
the nucleon is described by the inelasticity $y$ and is heavily shifted towards
small values of $y$\cite{elasticity_y}. This causes a big, irreducable
uncertainty when trying to estimate the original neutrino energy from these
kinds of events.  With the charged current interaction (mediated by the $W^\pm$
bosons) this isn't a problem however as the full neutrino energy ends up in the
resulting cascades.
\section{Askaryan effect}
For a particle shower to emit strong radio signals, two conditions have to be met:
\begin{itemize}
	\item There needs to be a separation of positive and negative charges in the shower front 
	\item The signals produced over the length of the shower profile need to overlap coherently.
\end{itemize}
The \textit{Askaryan} \cite{Askaryan} effect, also known as Askaryan radiation
describes the effect at radio frequencies which abides by both of these
conditions, in general it's a quite difficult effect but we'll give a crude
overview.  The previously described interactions create a shower of secondary
charged particles containing a charge anisotropy, this charge imbalance is a
result of medium electrons either Compton scattering into the advancing shower
or annihilating with shower positrons.  In the end you have a moving charge
anisotropy, propagating faster than the speed of light in the medium, creating
Cherenkov radiation.  Cherenkov radiation is like the electromagnetic
equivalent of a sonic boom, a sonic boom happens when something goes faster
than the speed of sound in the medium; A particle emits Cherenkov radiation if it
goes faster than the speed of light in the medium\footnote{The reader who wants a
	thorough explanation and derivation is advised to check out
\textit{Chapter 14: Radiation by Moving Charges} from the book
\textit{Classical Electrodynamics} by Jackson.} . Choosing the particle
trajectory to lie along the z axis we can approximately find an equation for
$\frac{\text{d}^2 \mathscr{J}}{\text{d}\omega \text{d}\Omega}$: the energy
radiated per elementary unit solid angle and per elementary unit frequency
interval
\begin{equation}
	\frac{\text{d}^2 \mathscr{J}(\omega)}{\text{d} \omega \text{d} \Omega} = \frac{q^2}{4\pi}\sqrt{\frac{\mu}{\epsilon}}\beta^2\omega^2\delta^2[\omega(1-\beta \mathbf{e}_r\cdot\mathbf{e}_z)]|\mathbf{e}_r\times\mathbf{e}_z|^2 \label{equation: 4.128 in elektromagnetisme}
\end{equation}
Now we can re-write this equation in spherical coordinates, which gives $1-\beta \mathbf{e}_r\cdot\mathbf{e}_z = 1-\beta\cos(\theta_c)$ in the delta function. We thus only expect radiation if
\begin{equation}
\cos(\theta_c) = \frac{1}{\beta} = \frac{c'}{u} = \frac{c}{n}\cdot\frac{1}{u}
\end{equation}
I.e if $u>\frac{c}{n}$ with n the index of refraction, Cherenkov radiation will be emitted along a cone surface with half angle $\frac{\pi}{2}-\theta_c$ as illustrated in figure \ref{figure: Cherenkov illustratie}. Integrating equation \ref{equation: 4.128 in elektromagnetisme} over the solid angle and formally dividing by the time interval we get:
\begin{equation}
	\frac{\text{d}^2\mathscr{J}}{\text{d}\omega \text{d}t} = \frac{q^2}{4\pi}\sqrt{\frac{\mu}{\epsilon}}\beta\omega\left(1-\frac{1}{\beta^2}\right)	
\end{equation}
We see that the energy is proportional to $\omega$, so we expect that most
radiation will be emitted "in blue", as seen in figure \ref{figure: Cherenkov
reactor}.  For ice the index of refraction is roughly 1.78 in deep ice, so we
expect an ultra-relativistic particle to produce the most radiation at around
56° opening as 
\begin{equation}
	\cos(\theta_c) \approx \frac{1}{n} \implies \cos^{-1}\left(\frac{1}{1.78}\right)\approx 56\text{°}
\end{equation}
\begin{figure}
\centering
\begin{minipage}{0.45\textwidth}
	\centering
	\copyrightbox[r]{\includegraphics[height = 0.8\textwidth]{Cherenkov-reactor.jpg}}{\textcopyright Argonne National Laboratory\\Advanced Test Reactor core, Idaho National Laboratory}
	\caption{Cherenkov radiation in a nuclear reactor}
	\label{figure: Cherenkov reactor}
\end{minipage}
\hspace{0.05\textwidth}
\begin{minipage}{0.45\textwidth}
	\centering
	\copyrightbox[r]{\includegraphics[height = 0.8\textwidth]{Cherenkov.pdf}}{\textcopyright Arpad Horvath}
	\caption{Diagrammatic representation of Cherenkov radiation}
	\label{figure: Cherenkov illustratie}
\end{minipage}
\end{figure}
Of course this is just an estimate, as the actual index of refraction is depth-dependent which
we'll get to in section \ref{section:Ice Model}.
Now this explains how the signals get generated but logically, from only knowing this
we'd expect radio waves to almost be non-existent 
due to the "in blue" nature of Cherenkov radiation. 
This isn't the full story however as we'll need to talk about coherent overlap
to fully understand the Askaryan effect. This can be intuitively explained as
follows: generally the shower is of length
$\mathcal{O}$(10cm)\cite{Huege_2017}, over this length the radiation gets
emitted, most frequencies decoherently interfering, but radio waves with wavelengths of 
$\approx$ 10cm coherently interfere, and it's these waves we then wish to detect.
\section{Polarization}
The generated electromagnetic radiation is polarized perpendicular to the
cherenkov cone, this can be useful to discern between two cherenkov cones whom,
timely, would generate the same response. This concept is illustrated below where
two neutrinos from different directions would generate the same signal in the detector.
If the detector has a way to differentiate between polarization however, there would be no
doubt where the neutrino originated from as the one producing the yellow cherenkov cone
would have a downwards polarization and the one producing a green cherenkov cone would have
an upwards polarization.
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.5\textwidth]{illu_polarization.pdf}
\end{figure}
\section{Wave propagation}
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\textwidth]{Path_illu.pdf}
	\label{fig:PathIllu}
	\caption{illustration of radiowave paths generated by a neutrino event}
\end{figure}
Waves propagating through ice to detectors generally looks something like
what's illustrated in figure \ref{fig:PathIllu}.  Here the interaction of the
neutrino happens somewhere in the neighbourhood of the red cross, the orange
rays represent the resulting radio wave paths to the detector channels which are
illustrated by blue dots. Notice that reflection at the surface is also a
possible path to the detector.  In a dielectric medium a ray
propagates with it's signal wave-speed determined by the local index
of refraction as $v = c/n$. 
The dependence of the index of refraction on
density for ice is given by the Schytt equation:
\begin{equation}
	n(x,y,z) \approx 1 + 0.78\rho(x,y,z)/\rho_0
	\label{eqn:Schytt}
\end{equation}
Where $\rho(x,y,z)$ is the local ice density and $\rho_0$ is the density for
solid ice (917 kg/m³).  The effect on speed isn't the only effect the index of
refraction has which we'll need to concern ourselves with however, if a ray
propagates towards a boundary dividing 2 media with different indexes of
refraction, the ray will refract and the refracted angle can be found from
Snell's law:
\begin{equation}
	n_1\sin{\theta_1} = n_2\sin{\theta_2}
\end{equation}
Where n is the index of refraction and $\theta$ is the angle
with respect to the surface normal.
The system we'll consider however, isn't 
homogeneous with some specified boundary, it's continous: ice
in greenland has a continously varying density. 
Because of this we can't work with Snell's law but we'll have to 
take a look at the continuous version
to figure out how these rays propagate. 
The "continuous version of Snell's law" is the eikonal equation:
a path of a ray $\mathbf{r}(s)$ with path parameter s in a medium
with index of refraction n($\mathbf{r}$) is described by:
\begin{equation}
	\frac{d}{ds}\left(n(\mathbf{r})\frac{d\mathbf{r}}{ds}\right) = \mathbf{\nabla} n
\end{equation}
The software we'll be using for ray reconstruction is called
"radiopropa" \cite{Winchen_2019} and in radiopropa the
local paraxial approximation is used, i.e. if we assume that in any
individual step of the algorithm the change of the refractive index
along the path ds is small it's possible to
re-write the equation as:
\begin{equation}
	n(\mathbf{r})\frac{d^2\mathbf{r}}{ds^2} \approx \mathbf{\nabla} n
	\label{eqn:radiopropaformula}
\end{equation}
Which is then easily iteratively solved.
If there are boundaries (such as defects or the surface)
these are treated seperately using Snell's law. 
\section{Ice model}
\label{section:Ice Model}
Equation \ref{eqn:radiopropaformula}, and thus the path, depends 
on the index of refraction on a given location. 
Purely from classical gravity and density considerations
it can be derived that the index of refraction abides by
\begin{equation}
	\label{eqn:expn}
	n(z) = n_{ice} - \Delta n e^{z/z_0}
\end{equation}
with $n_{ice}$ the refractive index of solid ice and $\Delta n = n_{ice} - n_s$
with $n_s$ the index of refraction of snow. This is called "the exponential
model".  Looking back at Schytt's equation we see that this model is a
consequence of the exponential nature the density would have.

This exponential model has a huge advantage as it's analytically 
solvable, meaning that we don't have to iteratively search for the 
path to the detector but know it instantly after the location of
the neutrino interaction and the detector are specified, the ray 
tracing software developed in complience with this exponential density
profile is called the \textit{analytic ray tracer}.

There is one big downside however: looking at measurements of the density i.f.o depth as shown in figure \ref{fig:DensityMeasurements} 
\begin{figure}
  \centering
	\includegraphics[width=0.5\textwidth]{Density_measurements.pdf}
	\caption{Measurements of the density (kg/m$^3$) i.f.o the depth with various fits}
	\label{fig:DensityMeasurements}
\end{figure}
And fitting the "exponential model" which can be derived by 
combining equations \ref{eqn:Schytt} and \ref{eqn:expn} to 
the form
\begin{equation}
	\rho_0 (n_{ice} - 1 + \Delta n e^{z/z_0}) = \rho
\end{equation}
or simply
\begin{equation}
	a(b + c e^{z/d}) = \rho
\end{equation}
it seems that the ice actually doesn't follow this exponential
curve perfectly but more closely some kind of polynomial. as an
example the curve "fifth order exponential"\footnote{This is
just an example, a better function can probably be found} was
included which has the structure
\begin{equation}
	a_5 exp(-z/z_0)^5 + a_4 exp(-z/z_0)^4 + a_3 exp(-z/z_0)^3 
	+ a_2 exp(-z/z_0)^2 + a_1 exp(-z/z_0) +a_0
\end{equation}
this discrepency between the exponential model and the actual
data implies that the analytic ray tracer will make the wrong
predictions.  This is why the development of a different ray
tracer was needed which will be able to handle more complex
(e.g polynomial) ice models, we'll get to this ray tracer in
chapter \ref{chapter:hybrid}.
\chapter{The Detector}
Both cosmic ray and neutrino detectors face the same main problem at the
highest energies: the steeply falling flux (as was previously discussed in
chapter 2) requires large effective areas, which leads to the construction of
neutrino detectors with volumes on the cubic kilometer scale: IceCube.  But
even IceCube has it's limitations, it's still too small to observe neutrino
events above the PeV scale, that's why a new detector was needed which was even
bigger.  We could just make IceCube bigger but this would cost a lot of money
as the individual detectors need to be spaced closely as IceCube works in the
visible spectrum for which the attenuation length is quite short. The proposed
solution was to work with radiowave detectors, leveraging the Askaryan effect
(as was previously explored, e.g in the NuMoon project).  Besides the advantage
radiowaves have due to their abundance, they can also propagate way further in
ice than visible light making it possible to space the individual detectors
further apart.

Thus the proposal for RNO-G was made, funded and now in the construction phase.
RNO-G is an array of autonomous radio stations each of which
having both surface channels and various deep channels resulting in a total of
24 channels per station. The whole project builds heavily on the knowledge
obtained through previous neutrino detectors like ARA, RICE and ARIANNA
experiments, as well as the balloon-borne ANITA experiment.

One such detector is illustrated in figure \ref{fig:detector}, the plan is to
build 35 of these as is shown in figure \ref{fig:station map}\footnote{note
that all the individual detectors are named after various species living in
greenland (in the native tongue)}.  .  Looking closely at one such detector we
see just below the surface 9 Log Periodic Dipole Antennas (LPDAs), these are
used to detect muon signals as muons will also generate cherencov radiation in
the ice whose signals can then be filtered out.  Aside form these surface
detectors there are also deep components of the detector which can be split up
in three parts: Two \textit{helper strings} and the \textit{power string}.

The helper strings are the 2 vertical cables shown on the right of figure
\ref{fig:detector} each housing 2 vertically polarized antennas (Vpols), one
quadslot antenna for the horizontal polarization component (Hpol) and one radio
pulser on each helper string which can be used to generate calibration signals.
As was mentioned in the previous chapter the polarization can be used to
distinguish between 2 possible cherenkov cones generating the same resulting
pulse, this effect will mostly concern vertical polarization, as such most
of the deep channels are vpol antennae.

The power string (the leftmost vertical cable) is more densely instrumented
than the helper strings: At the bottom it houses a set of four Vpol and two
Hpol antennas with a spacing of 1m and further up the string, with a spacing of
20m, are three more Vpol antennas.

The signal from each of these antennae are fed into a low-noise amplifier
directly above it, from there the signal is send to the data acquisition (DAQ)
system at the surface via a Radio Frequency over Fiber (RFoF) cable. There it's
again amplified, digitized and saved onto an SD card. This data is then
transmitted via a Long Term Evolution (LTE) telecommunications network to a
local server\footnote{There is additionally a Long Range Wide Area Network
(LoRaWAN) antenna as backup in case of problems with the LTE network}, from
where it is sent via a sattelite link.

There are solar panels as a power source who charge up battery banks, but as
there is't enough light during the Greenland winters, there're plans to build
wind turbines (with one of the problems being the possibly detectable RF noise
the 'engine' would produce).


It can,however, pose a challenge to reconstruct the radio signals produced by
the Cherenkov radiation as they are often obscured by background
noise. A solution used in RadioReco is Information Field Theory
(IFT) implemented in RadioReco by Welling et al.\cite{Welling_2021}
which uses Bayesian inference to calculate the most likely radio
signal, given recorded data.  

As was previously explained the radio signal from a neutrino often travels
along both direct and refracted paths (designated DnR) to the deep array. 
This double pulse characteristic would be a smoking-gun signature of an in-ice
source. The two helper strings are needed for a full direction reconstruction.
Three independent measurements are needed for azimuthal information, which is
provided by the Vpol (Vertical polarization) antennas and placing the Hpol
(Horizontal polarization) antennas at different depths on every string, both
zentih and azimuth information will be provided for those signals. The helper
strings' calibration pulsers, as well as one on the surface, will ensure
regular monitoring of the performance of the station and provide information
useful for precise calibration of the antenna geometry.

Christoph Welling did an investigation into energy reconstruction from the
received signals\cite{Welling_2019} for air showers in one single station (as
the RNO-G stations are so far apart this is the case here aswell) and he
noticed that it is nescessary to know if the detector who observes an event
falls inside or outside the Cherenkov cone to accurately reconstruct the
primary particle energy as most over-estimated energies in his simulations are
caused by events viewed from within the Cherenkov ring being mistaken for
events outside of it. He went on to show that, if we somehow know if the shower
was seen from inside or outside the ring from some extra source, that most
outliers in the energy disappeared. It is shown by Hiller et
al.\cite{Hiller_2017} that the combination of a muon detector with the radio
detector might make the issue of confusion between being within or outside of
the Cherenkov-ring disappear. Because of this the RNO-G stations are fitted
with surface Log Periodic Dipole Antennas (LPDA), capable of detecting muons.
Note that this is for air showers, the radio signal from neutrinos show
additional complexities.
\newpage
\section{Reconstruction: Lookup tables}
The main simulation code we'll be using consists of 2 parts:
NuRadioMC\cite{Glaser_2020} and NuRadioReco\cite{Glaser_2019}. NuRadioMC uses
Monte Carlo simulations to generate neutrino events in the ice and how they
propagate to the various channels. NuRadioReco is reconstruction software, it
simulates how the various detectors would respond to the detected radiowaves.
The plan is to simulate a lot of neutrino events and record the detector
responses in a giant database then, when an actual neutrino event occurs, we'll
only have to look in the database and match the actual detector response to the
simulated detector responses, thus finding the origin.
\section{Reconstruction: Butterworth filters}
Sometimes it is necessary to only let through a certain part of
the frequency spectrum that's recorded, an elegant way to accomplish
this is by using a Butterworth filter. This is a filter that's
applied afterwards on the measurements and only let's through 
a certain part of the observed frequency spectrum

\begin{figure}
	\centering
	\includegraphics[height=0.9\textheight]{figures/detector.pdf}	
	\caption{illustration of the detector}
	\label{fig:detector}
\end{figure}

\begin{figure}
	\includegraphics[width=\textwidth]{figures/station-map.png}	
	\caption{map of the station}
	\label{fig:station map}
\end{figure}

\chapter{Hybrid Ray tracer}
\label{chapter:hybrid}
%----------------------------------------------------------------------------------------
%	HYBRID RAY TRACER	
%----------------------------------------------------------------------------------------
\section{Shortcomings of the exponential ice model}
As mentioned in section \ref{section:Ice Model}, complex ice models will be
necessary moving forward as the exponential ice model fails to fit the density
curve.  The ideal software for radio wave propagation through ice is
radiopropa\cite{Winchen_2019}, but due to the way it works you'll have to know
the start point, the end point and the launch angle of your ray to work out the
path. This isn't difficult for the analytic model as it's exactly solvable but
for a general ice model you'll somehow have to find where to \textit{shoot} the
ray.  Work has been done on finding the launch angle in the case of complex ice
models by B. Oeyen et al. \cite{2022icrc.confE1027O}, where they created a ray
tracer which iteratively finds the solution, called the "iterative ray tracer".
The full explanation of how their algorithm works can be found in the mentioned
paper.  This is however a sub-optimal solution in python as an optimalisation
library will generally work faster, work had been done on trying to implement
such an algorithm deemed the "minimizer" but this attempt failed.  As we saw
this work the idea came to mind to combine the iterative ray tracer and the
code using the optimization libraries, to come up with the algorithm that will
be discussed in this chapter: The hybrid ray tracer, in the source code called
the "hybrid minimizer" which can be found
\href{https://github.com/arthuradriaens-code/NuRadioMC.git}{here} under the
radiopropa/hybrid\_minimizer branch.

It succeeds in more rapidly tracing the path from the event to the detector, is
more accurate and also arrives closer to the detector as the final result is
not limited by the final drawn sphere size but by a given tolerence making it
useful for plane wave reconstruction as we'll get to next chapter.

\section{How it works}
The hybrid minimizer can be seen as an extension of the iterative raytracer
\cite{2022icrc.confE1027O} as it starts out the same way: Say our source of
radiation is at position $\mathbf{X}_1$ and our detector is located at position
$\mathbf{X}_2$, we start by defining the vector $\mathbf{v} = \mathbf{X}_2 -
\mathbf{X}_1$, then we clone it as a new vector u and set u's z coordinate to
0, making it a normal vector of a plane parallel to the z direction. we now
wish to know where we'd actually be able to find possible paths, looking at
figure \ref{fig:PathIllu} we see that no solutions below the direct path are
possible as there would need to be upwards reflection, so we convert our vector
$\mathbf{v}$ representing the path from the source to the detector to spherical
coordinates, giving us a polar angle (zenith angle) "theta-direct". With this
we know that at the source the ray should propagate with an initial zenith
angle within the angle interval 0° to theta-direct° $:= \Omega$.

Next we need to define our "observers", if you shoot a ray with the radiopropa
module from a certain point at a certain angle the ray path will get simulated
until it interacts with this "observer".  Ideally we would like to a priori
know where to shoot our ray and have the detector be an infinitesimally small
observer in our simulation, but as we'll be working with general ice models
this can't be done.

The algorithm of finding the possible paths is then as follows: We define a
spherical observer at the location of the detector, with a radius of fair size.
We place an observer plane directly behind the detector (with normal vector
$\mathbf{u}$, no rays can propagate back after crossing) and an observer above
the surface (as no rays could make it back after escaping the ice) our full
setup is then what's illustrated in the figure below
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{algoillu.pdf}
\end{figure}\\

Here the red cross is the radio source, the blue horizontal line is the ice-air
boundary surface, the blue dot to the right is the detector and the green
$\Omega$ indicates the range over which solutions to the problem are possible.

We start off by just iteratively guessing: given a certain angle stepsize
$\Delta \theta$ shoot rays at the angles $\{0,\Delta \theta, 2\Delta
\theta,...,\Omega\}$ And see which ones get detected at the sphere around the
detector, this process is illustrated in a modified version of B. Oeyen et al.
their figure below\\
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.5\textwidth]{begin_explanation.png}
\end{figure}\\
if there are 2 distinct launch regions, it will start the so called "minimization", using scipy's module 
optimize.minimize. First we get rid of the spherical observer and place the vertical observer exactly at
the detector, now
to be able to use the minimize module we'll need a function to minimze, for this reason we define the function 
\textit{delta\_z} as, given a certain launch angle, returning the distance from the point where it lands on the
plane to the detector as illustrated below
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.5\textwidth]{PrincipleHybridIllu.pdf}
\end{figure}\\
The function we'll minimize is then detla\_z\_squared which is just the square of delta\_z as we wish it to be
as close as possible to 0, it gets minimized within the angle boundaries found from the previous step.
With this our algorithm is done, it does have a fail-safe as well for if the first step, finding the launch
regions, doesn't work namely it reverts back to being the iterative ray tracer.
\section{Performance Optimalisation}
To test the hybrid minimizer the numpy random module was used to generate
random coördinates, the considered square (as there is only a z component to
the ice model the 3D problem is cilindrically symmetric and thus essentially
only a 2D problem) is x:0.1km,4km and z:-0.1km,-3km.\footnote{This start at
100m depth was to get around issues concerning events that won't even trigger
in a full simulation} Every test point shown in the following subsections
consists of at least 500 random initial positions.  As the speed of the
algorithm is computer dependent the algorithm's speed is always plotted
relative to the iterative ray tracer's speed, simulated with the same
coordinates at the same time.
\subsection{Length of the normal vector}
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\textwidth]{figures/PrincipleNormIllu.pdf}
	\caption{how normal vector size influences the stepsize}
	\label{fig:normexpl}
\end{figure}
As visually explained in figure \ref{fig:normexpl}, the size of the normal vector seems to
influence how big the ray tracer's step size is taken close to the detector. This
thus influences the convergence and time taken. The results of varying this are shown
in figures \ref{fig:norminfl} and \ref{fig:norminfl2}.
Looking at these figures the first optimization conclusion is as expected: 
take the normal vector length to be 1 meter.
\subsection{ztol}
We'll now change the tolerence on the vertical distance away from the detector which is deemed
accepted i.e in figure \ref{fig:normexpl} if $\Delta z$ is below this threshold it's accepted.
The results are shown in figures \ref{fig:ztolinfl} and \ref{fig:ztolinfl2}.
From which we can conclude the second optimization conclusion: take ztol to be 0.05 m.
\subsection{Sphere Size \& Step Size}
The initial rays are sent out in steps of a certain angle and with a sphere
around the detector of a certain size. As this initial search for launch angle
regions is the slowest step in the hybrid ray tracer it's imperative to
optimize this. The procedure was: change the sphere size and loop over various
step sizes, recording the speed. The results are shown in figure \ref{fig:SphereStepInfl} 
the lower on the chart the better, zooming in onto the lowest point as is shown in a combined
plot on figure \ref{fig:SphereStepFinal}, we see that an optimum seems to be around a spheresize
of 45m and a stepsize of 0.7°.

\begin{figure*}
	\centering
\begin{minipage}{0.49\textwidth}
	\includegraphics[width=1.1\textwidth]{figures/hybrid_comparison_N_1000.pdf}
	\caption{Hybrid}
	\label{fig:acchyb}
\end{minipage}
\begin{minipage}{0.49\textwidth}
	\includegraphics[width=1.1\textwidth]{figures/iterative_comparison_N_1000.pdf}
	\caption{Iterative}
	\label{fig:accit}
\end{minipage}
\end{figure*}

\begin{figure}
	\centering
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/NormVsTime.pdf}
	\end{minipage}
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/NormVsSigmaTime.pdf}
	\end{minipage}
\caption{influence of the length of the normal vector}
\label{fig:norminfl}
\end{figure}
\begin{figure}
	\centering
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/NormVsTime.pdf}
	\end{minipage}
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/NormVsSigmaAZ.pdf}
	\end{minipage}
\caption{influence of the length of the normal vector}
\label{fig:norminfl2}
\end{figure}

\begin{figure}
	\centering
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/ZtolVsTime2.pdf}
	\end{minipage}
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/ZtolVsSigmaTime.pdf}
	\end{minipage}
\caption{influence of the tolerence on vertical distance}
\label{fig:ztolinfl}
\end{figure}

\begin{figure}
	\centering
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/ZtolVsTime2.pdf}
	\end{minipage}
	\begin{minipage}{\textwidth}
		\includegraphics[width=0.8\textwidth]{figures/ZtolVsSigmaAZ.pdf}
	\end{minipage}
\caption{influence of the tolerence on vertical distance}
\label{fig:ztolinfl2}
\end{figure}

\begin{figure}
	\includegraphics[width=\textwidth]{figures/subplotofallstepsphere.pdf}
	\caption{Variation in Sphere and angle step size with report on relative time.}
	\label{fig:SphereStepInfl}
\end{figure}

\begin{figure}
	\includegraphics[width=\textwidth]{figures/SphereAndStepFinal.pdf}
	\caption{Green values in variation in sphere and angle step size with report on relative time.}
	\label{fig:SphereStepFinal}
\end{figure}

\chapter{Weather Balloon}
In this chapter we'll simulate radio signals coming from a weather
balloon flying over the stations. Our goal is to use the plane waves 
method to reconstruct the position of the weather balloon with the
timing information inferred from the detected radio signals in the
detectors.
If this is somewhat succesfull it can be used (as we'll get to
shortly) to find out the local index of refraction in the ice.

There are 2 changes that need to happen first to our algorithm for us to
be able to simulate this: The air observers needs to be hard removed
as to make a ray tracing possible from within the air to the
detector and second off, we'll need to implement secondaries.
The problem is essentially that a ray coming from the balloon 
propagates to the ice, refracting and reflecting and then one 
of the refracted rays hits the detector. 
The "primary" ray is concidered the reflected one 
so we adjusted the algorithm to look at the secondary that ends
closest to the detector and return that ray. What this has as
a consequence is that the "path" you get back is only the path
from when it "became" a secondary (so only the part below the ice)
but this can be easily fixed as the radio wave just propagates
straight from the balloon to the beginning of that ray,  making 
the full ray reconstructable by just assuming a line from the 
balloon to the "start" of the ray.

From this information the propagation time from the balloon to the ice $t$ 
can later be added to the time of the path in the ice by measuring the 
length $d$ of the drawn line from the balloon to the beginning of the recorded path, 
setting the speed of radio waves in air to c and then just adding $t = d/c$.
\section{Plane Wave Reconstruction}
Now having modified our ray tracer, the first problem we'll consider is
plane wave reconstruction of the original position, an example path
to some of the deep sensors is given in figure \ref{fig:Example
trajectory}
\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{weerballontraject.pdf}
	\caption{Example trajectory of rays coming from a weather balloon (blue dot top right) and going through the ice to the various detectors (blue dots bottom left)}
	\label{fig:Example trajectory}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{planewave.pdf}
	\caption{Illustration of Plane waves}	
	\label{fig:Plane Wave}
\end{figure}
The plane wave reconstruction can easily be understood using figure
\ref{fig:Plane Wave}, the waves coming in are drawn in blue and
make a certain angle with the detectors. the top detector (top box)
detects the wave at a certain time $t_1$, the bottom detector
detects it at a time $t_2$. In our database, after decoding the
signal we'd thus see that these two detectors got a signal $\Delta t
= t_1 - t_2$ seconds apart from eachother. Now ideally this is
equal to the time $\Delta t'$ which is the time it took the wave
to propagate that distance which we can calculate from 
basic trigonometry and dimensional analysis:
\begin{equation}
	\Delta t' = \frac{m}{(m/s)} = (s/m)*m = v^{-1} * m = v^{-1} \cos\theta \Delta z
\end{equation}
With $v = c/n$ the local speed of light. As previously discussed this n is
depth-dependent and for comparison with the fitted index we'll be using the
models local index of refraction. Say we have 4 detectors at depths -94,-95,-96,-97,
this then would mean that we'll set the index of refraction at a depth of -95.5, 
exactly inbetween:
\begin{mintedbox}{python}
ice = medium.greenland_simple()
n_exact = ice.get_index_of_refraction(np.array[0,0,-95.5])
\end{mintedbox}
Now in reality we don't know the angle a priori, we'll only have the timing
information, so we'll perform a scan by minimizing something we define here as 
\textit{the correlation function}:
\begin{equation}
	Correlation(\theta) := \Delta t - \Delta t' = \Delta t
	- \frac{\cos\theta \Delta z}{v}
  \label{eqn:PlaneWave}
\end{equation}
If we have more than 1 detector however (which of course will be the case in RNO-G),
we'll need to specifiy various correlation functions.
E.g if we have four detectors labeled 0 to 3 we'll have to construct
correlation functions between detectors 0\&1, 0\&2, 0\&3, 1\&2, 1\&3 and 2\&3 .
As all of these correlation functions will have different
sizes we'll norm them as follows:
\begin{equation}
	Correlation_{Normed}(\theta) =
	\frac{Correlation(\theta)}{\int Correlation(\theta)\Delta
	\theta}
\end{equation}
An example of these correlation functions is shown in figure \ref{fig:NormedCorrelation}, 
notice how you can't differentiate between the correlation functions, this is only possible
because of the hybrid ray tracer having that high of a precision.
\begin{figure}
	\centering
	\includegraphics[width=0.8\textwidth]{NormedCorrelation.pdf}
	\caption{Example normed correlation functions}
	\label{fig:NormedCorrelation}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{SummedCorrelation.pdf}
	\caption{Example sum of the normed correlation functions}
	\label{fig:SummedCorrelation}
\end{figure}
After this we can sum them, as shown in figure \ref{fig:SummedCorrelation}, and look
where it reaches it's minimum. Using this angle we can then reconstruct a ray and guess 
where the weather balloon is approximately, this is illustrated in figure 
\ref{fig:WeatherBalloonPositionReconstruction}. 
\section{Is the goal feasible?}
In the example reconstruction illustrated in figure
\ref{fig:WeatherBalloonPositionReconstruction} the difference in angle between
direct to balloon and plane wave reconstruction is already quite small
(0.65329617\%) but as the balloon gets closer to the detector this reduces
significantly as is shown in figure
\ref{fig:WeatherBalloonClosePositionReconstruction} where the difference in
angle between direct to balloon and plane wave reconstruction is only
0.06788141\%. Our goal is to find the local index of refraction n by using the
plane wave reconstruction with the recorded timing and the positional data from
the weather balloon as the plane wave reconstruction is heavily dependent on
the index of refraction (as can be seen in equation \ref{eqn:PlaneWave}). As
was already established we'll consider the index of refraction in the middle of
all the detectors (instead of a different one for every pair of detectors),
after experimenting this doesn't seem to have an impact on the accuracy of the
plane wave reconstruction. 

Now we need to ask ourselves the question, within which angles should the
weather balloon fly for the data to be useful?  As was previously stated, the
further the weather balloon is away (in the x direction) the bigger the zenith
angle with the detector the less accurate the plane wave reconstruction.  So
which angles are acceptable? To determine this our method works as follows: 

we vary the position of the weather balloon in the x direction (keeping the
height constant), simulate the ray path to the channels 0 to 3 and then fit n
such that the difference between the reconstructed angle (from the plane wave
method) and the direct angle (angle between the middle of channels 0-3 and the
balloon) is the smallest possible.  Then we compare the n we have fit to the
one we know from the model at that position.  We quantise the discrepency
between these two indices of refraction using what we here define as the
\textit{relative accuracy}:
\begin{equation}
  \varepsilon\ (\%) = \frac{n_\text{fit} - n_{\text{exact}}}{n_{\text{exact}}} \times 100
\end{equation}
Carrying this out\footnote{The code for this can be found in projects-mt/BaLLooN/simulations as plane\_wave.py} we get figure \ref{fig:EpsilonIFODirect}, i.e it gets
exponentially shifted towards higher n as the balloon moves further away. If we wish our
accuracy to be within 1\%, the angle the balloon makes with the middle of channels 0 to 3 needs
to be less than 10°.
\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{EpsilonIFODirect.pdf}
	\caption{Epsilon in function of the direct angle}
	\label{fig:EpsilonIFODirect}
\end{figure}
\begin{figure}
  \centering
  \includegraphics[width=0.7\textwidth]{BobsWeatherBalloonHeight.pdf}
  \caption{Height data viewed in ROOT}
  \label{fig:BobsWeatherBalloonHeight}
\end{figure}
An example path of a weather balloon is shown in figure
\ref{fig:ExampleBalloonPath}, looking specifically at the height information
recorded by the weather balloon in a .root file using
ROOT\footnote{\url{https://root.cern/}} we get what is shown in figure
\ref{fig:BobsWeatherBalloonHeight}. It can be seen that the elevation varies
between 3228m (read the graph as: Over a 1000 data entries at that height) and
22755m (entries go to zero after that height).  This is relative to sea-level,
looking at the height map of greenland as shown in figure
\ref{fig:HeightMapGreenland}
\begin{figure}
  \centering
  \includegraphics[width=0.4\textwidth]{GreenlandHeight.png}
  \caption{Height map of greenland}
  \label{fig:HeightMapGreenland}
\end{figure}
this is obvious.  It's quite difficult to work directly with the global geographic
coordinate system (longitudinal, latitude and elevation coordinates),
that's why we convert them to local ENU coordinates (north, east, up)
relative to the 'DISC' which is located at 72.58279265212887 latitude,
-38.45581495328228 longitude and 3251.9489147560234 elevation.

Now what would our $<$10° policy entail? And is it even possible? 
Say we take a look at station Terianniaq (station 12)
it's located at 72.6000868058195° N -38.4962265332872° W.
converting this into ENU coordinates we get -137.67250176003688N
1727.5184983294744E, we then set our "up" to be -95.5m as this is the
approximate location of the middle of channels 0-3.  Now looking at e.g the
Balloon path recorded on the 20th of august 2022 (figure
\ref{fig:ExampleBalloonPathCrossing12}) we see that the balloon crosses paths
closely with detector 12, but how close was this encounter? To quantize this we can take a look at every data
entry (there are $>$12000 entries) individually and compute the angle the
balloon makes with the detector by first converting the location of the balloon
in ENU coordinates, then calculating the horizontal distance ($\sqrt{(x-x')^2 +
(y-y')^2}$) then the relative vertical distance $|z - z'|$ and then from those
compute the angle ($tan(\theta) = \frac{Hor.}{Vert.}$) doing this and recording
when the balloon gets close enough to get below the 10° mark we get figure
\ref{fig:ExampleBalloonPathCrossing12LessThan10}. We thus see that in this
example the $<10$° policy is viable.

Now how much data do we have that way? 
We'll be looking at the data recorded over the summer of
2022, more particularly 15/06/2022 - 30/09/2022.
The positional data of the weather balloons was obtained from the
\url{ftp1.esrl.noaa.gov} website using the rno-g-sonde script of the official
RNO-G github page .After looping through every weather
balloon gpx file recorded in the summer of 2022 and seeing where it get's
within 10 degrees we get the data shown in appendix \ref{app:10Deg}, even
though this is quite a lot of data there's still another step that we could do
to broaden the amount of usable data.
\subsection{Refraction at the surface}
Up until now we have not used the property that waves refract at the surface as
we didn't want to assume anything, now say that we include refraction at the
surface for our plane wave reconstruction. This would mean that we'd follow
analogous steps as our previous analysis, i.e doing a plane wave reconstruction
from the difference in timing and trying to fit the index of refraction, only
now the plane wave abides with snell's law at the surface, going from n=1.27 to
n=1 and we'll need to minimize the horizontal distance from the ray at the
height of the balloon and the balloon, not the angle.  
The full algorithm thus goes as follows: We first reconstruct the
plane wave launch angle $\theta_1$ by minimizing the correlation function
previously defined, this gives us a function
\begin{equation}
	z = a_{InIce}*x + b_{InIce}
	\label{eqn:InIcePlaneWave}
\end{equation}
The outgoing zenith angle at the surface $\theta_2$ can be calculated from snell's law:
\begin{equation}
n_1 \sin{\theta_1} = n_2 \sin{\theta_2} \implies  \theta_2 = \sin^{-1}\left(\frac{n_1}{n_2}\sin{\theta_1}\right)
\end{equation}
from this we know the slope of the wave path $a_{InAir} = \tan\left({\frac{\pi}{2} -
\theta_2}\right)$ but not the offset, but this can easily be found from equation
\ref{eqn:InIcePlaneWave} as 
\begin{equation}
	z = 0 = a_{InIce}*x_{End} + b_{InIce} \implies x_{End} = -\frac{b_{InIce}}{a_{InIce}}
\end{equation}
and 
\begin{align}
	z = 0 = a_{InAir}*x_{End} + b_{InAir} \implies b_{InAir} &= -a_{InAir}*x_{End}
	\\&= a_{InAir}* \frac{b_{InIce}}{a_{InIce}}
\end{align}
Now that we have the function describing the "path of the plane wave"\footnote{we use double
quotes as to emphasize that this is a reconstruction method and not an actual wave} in the air 
we can find out the horizontal position at the height of the balloon as
\begin{equation}
	z = z_{Balloon} = a_{InAir}*x_{f} + b_{InAir} \implies x_f = \frac{z_{Balloon} - b_{InAir}}{a_{InAir}}
\end{equation}
and iteratively loop over possible indices of refraction, minimizing $|x_{Balloon} - x_f|$.

Doing this whilst looping over possible horizontal balloon positions, we get
the result shown in figure \ref{fig:EpsilonIFODirectSnell}\footnote{The code
for this can be found in projects-mt/BaLLooN/simulations as
plane\_wave\_with\_snell.py}
\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{EpsilonIFODirectSnell.pdf}
	\caption{epsilon IFO possible angles from channels 0-3 with refraction at the surface}
	\label{fig:EpsilonIFODirectSnell}
\end{figure}
As you can see we can now go up to 15° and still have less than 1\% error!  The
only drawback of this method is that we need to assume the index of refraction
to be 1.27 at the surface of the ice, if this isn't the case in some places our
predictions won't be accurate.
\begin{figure}
  \centering
	\includegraphics[width=0.7\textwidth]{StartAndStop10Illu.pdf}
  \caption{Illustration of when the angle with the deep array (channels 0-3) with the weather balloon is less than 10 degrees,
  the green mark indicates when it starts being less than 10 degrees and the red mark when it stops being less than 10 degrees.}
  \label{fig:ExampleBalloonPathCrossing12LessThan10}
\end{figure}

\begin{figure}
  \centering
	\includegraphics[width=0.7\textwidth]{PathSMT_20220820_111609.pdf}
  \caption{Path traced out by a weather balloon released at 20/08/2022}
  \label{fig:ExampleBalloonPathCrossing12}
\end{figure}
\begin{figure}
  \centering
	\includegraphics[width=0.7\textwidth]{WeatherBalloonPath.png}
  \caption{Path traced out by a weather balloon released by Bob Oeyen, the checkmark indicating the start and the house mark
  the end}
  \label{fig:ExampleBalloonPath}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{WeatherBalloonPositionReconstruction.pdf}
	\caption{Example plane wave reconstruction of weather balloon position}
	\label{fig:WeatherBalloonPositionReconstruction}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{WeatherBalloonClosePositionReconstruction.pdf}
	\caption{Example plane wave reconstruction of near-flying weather balloon position}
	\label{fig:WeatherBalloonClosePositionReconstruction}
\end{figure}
\newpage
\section{Error on prediction}
Running ahead on the actual measurements, let's estimate how accurate our
predictions will be (in the non-snell case).  For the moment we're only
interested in the deep channels 0-3. Let's label the vertical spatial accuracy,
i.e how accurately we know the height of these channels, $\delta z$\footnote{meaning if we have a measurement $z_i$ the true value is within $z_i
\pm \delta z$ with 95\% certainty}. And the timely accuracy, or how accurate the
vpol timing characteristics are, $\delta t$. If we want to fit n, we first
minimize the summed correlation function to construct the plane wave. One
correlation function is given by 
\begin{equation}
	Correlation(\theta) := \Delta t - \Delta t' = \Delta t
	- \frac{\cos\theta \Delta z}{v}
\end{equation}
Say the minimum occurs at $Correlation(\theta) = Correlation(\theta_{min}) := \mathcal{C}$, we can then re-write 
this equation for n:
\begin{equation}
  n = \frac{c(\Delta t - \mathcal{C})}{\cos \theta_{min} \Delta z} = \frac{c}{\cos{\theta_{min}}}\left[\frac{\Delta t}{\Delta z} - \frac{\mathcal{C}}{\Delta z}\right]
\end{equation}
The $\Delta z$ is the vertical distance between two channels and thus has an error of $2\delta z$ and $\Delta t$ is the time
difference between two channels, implying an error $2\delta t$. 
Let's look at the two terms seperately (assuming the error on $\theta_{min}$ to be negligable),
the first quotient $\phi_1 := \Delta t/\Delta z$ has a variance \cite{grabe2005measurement} of
\begin{equation}
	s_{\phi_1}^2 = \frac{1}{{\Delta z}^2}s_{\Delta t}^2 - 2 \frac{{\Delta t}}{{\Delta z}^3}s_{\Delta t \Delta z} + \frac{{\Delta t}^2}{{\Delta z}^4}s_{\Delta z}^2
\end{equation}
Assuming $\Delta t$ and $\Delta z$ to be independent:
\begin{align}
	s_{\phi_1}^2 &= \frac{1}{{\Delta z}^2}s_{\Delta t}^2 + \frac{{\Delta t}^2}{{\Delta z}^4}s_{\Delta z}^2\\
	&= 4\left(\frac{1}{{\Delta z}^2}{\delta t}^2 + \frac{{\Delta t}^2}{{\Delta z}^4}{\delta z}^2\right)
\end{align}
And the second term ($\phi_2 := -\mathcal{C}/\Delta z$):
\begin{align}
	s_{\phi_2}^2 &= \frac{\mathcal{C}^2}{{\Delta z}^2}s_{\Delta t}^2\\
		     &= 4\frac{\mathcal{C}^2}{{\Delta z}^2}{\delta t}^2\\
\end{align}
Our uncertainty on the index of refraction is thus (neglecting unknown systematic errors):
\begin{equation}
	\delta n =4\left(\frac{c}{\cos{\theta_{min}}}\right) \left( \frac{1}{{\Delta z}^2}{\delta t}^2 + \frac{{\Delta t}^2}{{\Delta z}^4}{\delta z}^2 + 
\frac{\mathcal{C}^2}{{\Delta z}^2}{\delta t}^2\right)
\end{equation}
%As we actually summed the correlation functions (6 in total), it's equivalent
%to doing 6 independent measurements of n, meaning that we get a reduction by a
%factor $\sim \sqrt{6}$.  
Even though we know our $\epsilon$ to always
overestimate the actual value, meaning that we could theoretically account for
this by just calculating $\epsilon$ for the considered system and correcting,
let's assume it to be an absolute error.  Now due to this inherent inaccuracy,
n also has an additional error of $\pm \epsilon(\vec{r})$ with $\vec{r}$ the
position of the balloon. Our final error on n is thus:
\begin{equation}
  \delta n(\vec{r})=  \epsilon(\vec{r}) + 4\left(\frac{c}{\cos{\theta_{min}}}\right) \left( \frac{1}{{\Delta z}^2}{\delta t}^2 + \frac{{\Delta t}^2}{{\Delta z}^4}{\delta z}^2 + 
\frac{\mathcal{C}^2}{{\Delta z}^2}{\delta t}^2\right)
  \label{eqn:total error}
\end{equation}
If we assume the $\epsilon$ to overestimate the index of refraction the same way in real
life as in the simulation however, our estimated $n$ can be corrected as
\begin{equation}
  n_{\text{corrected}} (\vec{r})= \frac{n(\vec{r})}{\epsilon(\vec{r}) + 1}
\end{equation}
and our error becomes only the second part of equation \ref{eqn:total error}.
\newpage
\section{Fitting the index}
Now that we know our goal to be feasible, let's analyse some data.  As we'll
start by just analysing one event, let's take one of the best events possible
for our analysis.  A close look at graph \ref{fig:EpsilonIFODirect} shows that
events under 5° produce an error of less than 0.22\%, implying that if we
measure n to be 1.7407 our error will only be 0.0038. After looping through all
the balloon positional files and only outputting the $<5°$ ones we get some
moments where balloons were actually close enough (note that $<5°$ almost never
happens at low heights).

If we search in the DESY database
\footnote{\url{https://rnog-monitor.zeuthen.desy.de/}} within the calculated
timeframes for the particular detectors where the balloon gets close enough to,
AND where the 403MHz signal coming from the Ballon (see figure
\ref{fig:BalloonFreq}) is detected in the deep channels, the events of the 29th
of august stands out; between 11:18:46 and 11:18:56, the balloon gets really
close to detector 23 as can be seen on figure \ref{fig:29/08/22}.
\begin{figure}
	\centering
	\includegraphics[width=0.4\textwidth]{29-08-Encounter.png}
	\caption{Close encounter between a weather balloon and detector 23 on the 29th of august 2022 at 11:18}
	\label{fig:29/08/22}
\end{figure}
If we take a look
at the detected signals we see that at run 691 the event 489 gets recorded at
2022-08-29 11:18:32+00:00 showing a clear 403MHz peak at channels 5-7.
It is of course unfortunate that we don't get to measure the index of refraction
at the deep component jet but a quick calculation shows that if we measure the
index of refraction using detectors 5 and 6 (getting the index of refraction at -70m) 
the error will be $\approx 0.5\%$ which is a nice start\footnote{This calculation was
performed with the program CalculateInherentErrorWithSnell.py located in projects-mt/BaLLooN/RealData}.

Now to calculate the differences in timing for this received signal, the code
used for this is called FitN.py and stored at the repository
\href{projects-mt}{https://github.com/arthuradriaens-code/projects-mt.git}
under BaLLooN/RealData, let's go over the full code step by step:

\subsection{Spatial data}
The first part we'll need to concern ourselves with is determining the relative
positions of everything. The balloon data file and the time when the event took
place are given, from these two both the latitudenal and longitudinal position
and elevation of the balloon at the given time is determined. We convert these
three measurements to the ENU coordinate frame and store it in the array
\textit{BalloonPosition}. The next step is to get the location of the detector,
for this we first instantiate a detector object 

\begin{mintedbox}{python}
det = NuRadioReco.detector.detector.Detector(json_file="RNO_season_2022.json")
\end{mintedbox}

The RNO season 2022 json file can be found on the official RNO-G github
under "analysis-tools", then we "update" the detector to the event time and get the
absolute position of our detector (station 23) via the get\_absolute\_position module:

\begin{mintedbox}{python}
	stationlocation = det.get_absolute_position(station_id)
\end{mintedbox}

Now that we have both the position of our balloon and station 23 in ENU coordinates,
let's make the calculations simpler by setting the detector as the central coordinate.
i.e our new balloon position will be

\begin{equation}
	\textit{RelBalloon} = \textit{BalloonPosition} - \textit{station}
\end{equation}

And as we might want to plot this later, due to the cylindrical symmetry, we can rotate
the coordinates to get rid of our y-axis. We can do this by defining the radius:

\begin{equation}
	r := \sqrt{\textit{RelBalloon}_x^2 + \textit{RelBalloon}_y^2}
\end{equation}

and just setting this equal to $\textit{Balloon}_x$ and setting $\textit{Balloon}_y$ to
zero (equivalent to setting $\theta= 0$ in a rotation).

Now we don't have the position of our individual channels yet, only of the station itself,
these can however easily be obtained using the get\_relative\_position module on our
detector object, as we chose our station to be the center of the coordinate system,
these relative positions are absolute positions in our frame of reference.

\subsection{Time difference}
Now that we have our geometry, let's analyse the data for the channels 6 and 7, the data
for a particulal channel is stored in a channel object. From this object 
we can get the recorded voltages with the get\_trace() module, the recorded times
with the get\_times() module, the recorded frequencies with the get\_frequencies() and
the recorded spectrum corresponding to these frequencies with get\_frequency\_spectrum()
, note that the last two do a FFT on our data.
The recorded spectrum of both channels is given in figure \ref{fig:freqs67}, we observe
a clear spike at 403MHz.
\begin{figure}
	\begin{minipage}{0.49\textwidth}
		\includegraphics[width=\textwidth]{23-489-6-freq.pdf}
	\end{minipage}
	\begin{minipage}{0.49\textwidth}
		\includegraphics[width=\textwidth]{23-489-7-freq.pdf}
	\end{minipage}
	\caption{recorded frequencies on detector 23 at 2022/08/29 11:18:32}
	\label{fig:freqs67}
\end{figure}

We know that the signal sent out by the weather balloon is a
"sinusoidal" wave, and also that the frequency is
403MHz. As the data is measured in nanoseconds
the frequency is:
\begin{equation}
	f = 403\text{MHz} = 403\times 10^{-3} \frac{1}{\text{ns}}
\end{equation}
But the signal is not a sine wave of the form
\begin{equation}
	\mathcal{S} = A\cdot\sin\left(\omega t + T\right)
\end{equation}
with
\begin{equation}
	\omega = 2\pi f
\end{equation}
As, if you just fit this sine to the data making the differences
with the actual signal as close to zero as possible you get the two
fits are shown in figure \ref{fig:voltage67}.
\begin{figure}
	\begin{minipage}{0.49\textwidth}
		\includegraphics[width=\textwidth]{FittedCh6.pdf}
	\end{minipage}
	\begin{minipage}{0.49\textwidth}
		\includegraphics[width=\textwidth]{FittedCh7.pdf}
	\end{minipage}
	\caption{recorded voltage i.f.o time on detector 23 at 2022/08/29 11:18:32 for
	channels 6 and 7}
	\label{fig:voltage67}
\end{figure}
These fits are terrible, that's why we'll first pass this signal
through a fifth order butterworth filter with a passband of
[0.4031,0.4032]\footnote{This is a filter that only let's certain frequencies pass}. Doing this however we notice that the signal looks as shown in figure \ref{fig:ModulatedChannels}, where it's clear
that even though the balloon sends out a 403MHz frequency, this
signal is amplitude modulated (AM) with a sine wave. We'll thus
have to fit a function of the form

\begin{equation}
	\mathcal{S} = A\cdot\sin\left(0.403*2\pi t + \phi_1\right)\sin\left(2\pi f + T\right)
\end{equation}


\begin{figure}
	\begin{minipage}{0.49\textwidth}
		\includegraphics[width=\textwidth]{ModulatedCh6.pdf}
	\end{minipage}
	\begin{minipage}{0.49\textwidth}
		\includegraphics[width=\textwidth]{ModulatedCh7.pdf}
	\end{minipage}
	\caption{recorded voltage i.f.o time on detector 23 at 2022/08/29 11:18:32 for
	channels 6 and 7}
	\label{fig:ModulatedChannels}
\end{figure}

This offset can then be used to know the time difference
between the two signals.

Before actually fitting our signal there's one important
consideration that we haven't made yet: cable delay. We get
the delay for the individual channels with the
get\_cable\_delay module, say our couble delays on channels a
and b are $t_a^d$ and $t_b^d$, the recorded times (from
fitting the sine) are thus of the form $t^f = t + t^d$, our
actual difference in timing is thus:
\begin{equation}
	t_b - t_a = t_b^f - t_a^f - (t_b^d - t_a^d)
\end{equation}
Now if we'd want to 
\begin{figure}
  \centering
  \includegraphics[width=0.5\textwidth]{Frequencies.pdf}
  \caption{Frequencies sent out by the weather balloon}
  \label{fig:BalloonFreq}
\end{figure}

\appendix
\chapter{List of abbreviations}
Radio Neutrino Observatory in Greenland (RNO-G)
ultra high energy (UHE)
Gamma-ray bursts (GRBs)
Cosmic Microwave Background CMB
Fast Fourrier Transform FFT
\chapter{Balloon passbys under 10°\\ in the summer of 2022}
\label{app:10Deg}
\begin{table}[h!]
\csvautotabular{tables/EventsBelow10DegPart5.csv}
\end{table}
\begin{table}
\csvautotabular{tables/EventsBelow10DegPart1.csv}
\end{table}
\begin{table}
\csvautotabular{tables/EventsBelow10DegPart2.csv}
\end{table}
\begin{table}
\csvautotabular{tables/EventsBelow10DegPart3.csv}
\end{table}
\begin{table}
\csvautotabular{tables/EventsBelow10DegPart4.csv}
\end{table}

% =====================================================================
% End matter
% =====================================================================
\newpage
%----------------------------------------------------------------------------------------
%	REFERENCE LIST
%----------------------------------------------------------------------------------------
\bibliography{sources}
\bibliographystyle{plain}

\end{document}
